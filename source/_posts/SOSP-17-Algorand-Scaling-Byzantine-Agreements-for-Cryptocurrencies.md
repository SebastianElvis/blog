---
title: 'SOSP''17 - Algorand: Scaling Byzantine Agreements for Cryptocurrencies'
date: 2019-01-13 13:29:57
categories:
- paper reading
tags:
- Scalability
- VRF
- Consensus
---




# Info

- **Title**:  Algorand: Scaling Byzantine Agreements for Cryptocurrencies
- **Conference**: SOSP
- **Year**: 2017
- **URL**: https://people.csail.mit.edu/nickolai/papers/gilad-algorand-eprint.pdf
- **Source code**: No

# Addressed Problems

- Mitigating forks requires two unfortunate sacrifices: 
  - the time to growthe chain by one block must be reasonably high (e.g., 10 minutes in Bitcoin), 
  - applications must wait for several blocks in order to ensure their transaction remains on the authoritative chain (6 blocks are recommended in Bitcoin [7]). 
- The result is that it takes about an hour to confirm a transaction in Bitcoin.

# Solution

- This paper presents Algorand, a new cryptocurrency designed to confirm transactions on the order of **one minute**. 
- The core of Algorand uses a Byzantine agreement protocol called BA⋆ that scales to many users, which allows Algorand to reach consensus on a newblock with 
  - low latency 
  - without the possibility of forks.
- A key technique that makes BA⋆ suitable for Algorand is the use of verifiable random functions (VRFs) [39] to randomly select users in a private and non-interactive way.

# Methodology

## Challenges and Solutions

- Challenges
  - Algorand must avoid Sybil attacks
  - BA⋆ must scale to millions of users
  - Algorand must be resilient to DoS attacks
- Solutions
  - Weighted users: In Algorand, we weigh users based on the money in their account.
  - Consensus by committee: choosing a small set of representatives randomly selected from all users to run BA*
  - Cryptographic sortition 
    - BA⋆ selects committee members in a **private** and **non-interactive** way. This means that every user in the system can independently determine if they are chosen to be on the committee
    - Implemented by a VRF [39] of their private key and public information from the blockchain
    - If the function indicates that the user is chosen, it returns a short string that proves this user’s committee membership to other users, which the user can include in his network messages. 
    - Since membership selection is non-interactive, an adversary does not know which user to target until that user starts participating in BA⋆.
  - Participant replacement: 
    - an adversary may target a committee member once that member sends a message in BA⋆
    - BA⋆ mitigates this attack by requiring committee members to speak just once.
    - Thus, once a committeemember sends his message (exposing his identity to an adversary), the committee member becomes irrelevant to BA⋆

## Cryptographic Sortition by VRF

- Cryptographic sortition is an algorithm for choosing a ran- dom subset of users according to per-user weights.
- Sortition is implemented using verifiable random functions (VRFs) [39].

### VRF

- $sk, pk$: secret key and public key
- $VRF_{sk}(x) \rightarrow (hash, \pi)$
  - $x$ is any input (the seed)
  - $hash$ is a *hashlen-bit-long* value 
    - uniquely determined by $sk$ and $x$ 
    - indistinguishable from random to anyone that does not know $sk$
  - $\pi$ is the proof enables anyone that knows $pk$ to check that $hash$ indeed corresponds to $x$
- $Verify_{pk}(\pi) \rightarrow \{0, 1\}$
  - Verify that
    - $hash$ is indeed corresponding to $x$
    - $hash$ is generated by the owner of $sk$

### Cryptographic Sortition

Procedure $Sortition(sk, seed, \tau, w, W)$:
1. $(hash, \pi) \leftarrow VRF_{sk}(seed|role) $
2. $p \leftarrow \frac{\tau}{W}$, $j = 0$
3. While $ \frac{hash}{s^{hashlen}} \notin [ \sum_{k=0}^{j} B(k;w,p), \sum_{k=0}^{j+1} B(k;w,p) ) $ do
   3.1. $j++$
4. return $(hash, \pi, j)$ 

Description:
- $\tau$: the *weight* threshold to be the committee (an integer)
- $W$: total amount of currency units in Algorand blockchain
- $w$: your amount of currency units
- $B(k;w,p) = (_{k}^{w})p^{k}(1−p)^{w−k}$ is a binomial distribution, where $\sum_{k=0}^{w} B(k;w,p) = 1$
  - Assume you have $w$ coins, flip it, $P(front) = p$
  - $B(k;w,p)$ means the probability that you have exactly $k$ times with front side for $w$-time flipping

Insight:
- Parameters:
  - The unit above is selected with probability $p = \frac{\tau}{W}$ , where $W$ is the total amount of currency units in Algorand
- Splitting the $[0,1)$ to consecutive $j$ intervals:
  - $I^{j} = [ \sum_{k=0}^{j} B(k;w,p), \sum_{k=0}^{j+1} B(k;w,p) ) $ for $ j \in \{0,1, \dots ,w\}$.
  - join all $I^{j}$ $\Rightarrow$ $[0, 1)$
  - $I^{j} \Rightarrow$ [ P($\leq j$), P($\leq j+1$) )
- User selection
  - To select users in proportion to their money, we consider each unit of Algorand currency as a different "sub-user"
  - Being chosen $j$ times means that the user gets to participate as $j$ different "sub-users"
  - If user $i$ owns $w_{i}$ (integral) units of Algorand, then simulated user $(i, j)$ with $j \in \{1, \dots ,w_{i} \}$ represents the j-th unit of currency $i$ owns
  - If $\frac{hash}{2^{hashlen}}$ (where hashlen is the bit-length of hash) falls in the interval $I^{j}$ , then the user has exactly $j$ selected sub-users (coins).
  - The number of selected sub-users is publicly verifiable using the proof $\pi$ (from the VRF output).
- Weights
  - "sub-users" $j$ is an integer considered as the *weight*
  - With bigger $w$ (i.e. more money), you will have a higher bound of $j$ (higher bound is $w$)

Properties:
- given a random seed, the VRF outputs a pseudo-random hash value, which is essentially uniformly distributed between 0 and $2^{hashlen −1}$.
  - As a result, users are selected at random based on their weights
- an adversary that does not know $sk_{i}$  
  - CANNOT guess the *weight* of i
  - CANNOT if $i$ was chosen as the committee
- After BA* the committee members are publicly known, but it's too late for attackers

### Choosing Seed for Each Round

In each round of Algorand a new seed is published.

- For Round $r$, the seed is determined by the previous-round seed
- $⟨seed_{r} ,\pi⟩ \leftarrow VRF_{sk_{u}} (seed_{r−1} || r)$

where $u$ proposer of the last block. (TODO: need more details)


## block Proposal 

- Block proposer $=$ committee members this round
- To ensure that some block is proposed in each round, Algorand sets the sortition threshold (the minimum of *weight*) for the block-proposal role
- Defined as $\tau \gt 1$ proposer (although Algorand will reach consensus on at most one of these proposed blocks). 
- Appendix B of the technical report [27] proves that choosing $\tau = 26$ ensures that a reasonable number of proposers ($1 \leq n \leq 70$ empirically) are chosen with very high probability (e.g., $\frac{10}{11}$).

## BA*

TODO

# Relevance

- VRF provides good properties for generating publicly verifiable randomness and joint distributed randomness
- A possible approach to minize the communication complexity

# To discuss/investigate

- Implement the cryptographic sortition.